<!-- today_word/templates/today_word/create_new_word.html -->
{% extends 'blog/base_full_width.html' %}

{% block main_area %}
<h2>Create New Post</h2>
<hr/>
<form method="post" action="{% url 'post_create' %}">
    {% csrf_token %}
    <label for="id_title">Title*</label>
    <input type="text" id="id_title" name="title" class="form-control" required>

    <button type="button" id="generate-content-btn" class="btn btn-primary mt-2">Generate Content</button>

    <label for="id_content" class="mt-4">Content*</label>

    <textarea id="id_content" name="content" rows="10" class="form-control" required></textarea>

    <label for="id_tags_str" class="mt-4">Tags</label>
    <input type="text" name="tags_str" id="id_tags_str" class="form-control" placeholder="Enter tags separated by commas">

    <button type="submit" class="btn btn-success mt-3">Submit</button>
</form>

<!-- 가운데에 로딩 아이콘과 텍스트 추가 -->
<div id="loading-spinner" style="display: none;">
    <div class="spinner-overlay">
        <div class="spinner"></div>
        <p class="loading-text">loading...</p>
    </div>
</div>

<style>
    /* 화면 중앙에 배치된 로딩 오버레이 스타일 */
    .spinner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000; /* 최상단 레이어 */
    }

    /* 로딩 아이콘 스타일 */
    .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    /* loading... 텍스트 스타일 */
    .loading-text {
        margin-top: 15px; /* 아이콘과 텍스트 간격 */
        color: #ffffff;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
    }

    /* 스피너 애니메이션 */
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>



<script>
document.getElementById("generate-content-btn").addEventListener("click", function() {
    const title = document.getElementById("id_title").value;
    const csrftoken = '{{ csrf_token }}';

    if (!title) {
        alert("Please enter a title first.");
        return;
    }

    // 로딩 아이콘 표시
    document.getElementById("loading-spinner").style.display = "block";

    fetch("./generate_content/", {
        method: "POST",
        headers: {
            "X-CSRFToken": csrftoken,
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({title: title})
    })
    .then(response => response.json())
    .then(data => {
        if (data.content) {
            document.getElementById("id_content").value = data.content;
        } else if (data.error) {
            alert(data.error);
        }
    })
    .catch(error => console.error("Error:", error))
    .finally(() => {
        // 로딩 아이콘 숨기기
        document.getElementById("loading-spinner").style.display = "none";
    });
});
</script>


{% endblock %}